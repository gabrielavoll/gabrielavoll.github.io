<!DOCTYPE html><html><head><title>gato333 Blog</title><link rel="stylesheet" href="/main.css"><link rel="shortcut icon" type="image/x-icon" href="/public/favicon.ico"><script src="/js/app.js"></script><link href="https://fonts.googleapis.com/css?family=Maven+Pro" rel="stylesheet"></head><body><div class="nav-wrapper"><div class="nav"><ul class="nav-inner"><li><a href="/articles">Blog</a></li><li><a href="/code">Code</a></li><li><a onclick="scrollToDiv('experience');">Experience</a></li><li><a onclick="scrollToDiv('about');">About</a></li><li><a onclick="scrollToDiv('footer');">Contact</a></li></ul></div></div><div class="article"><div class="article-title"><h4>2017-11-06</h4><h1>Sample Braintree Intergration NodeJS/Braintree v3 Javascript client/Hosted Fields</h1><h5>tags: braintree, ecommerce, javascript, braintree-client, nodejs, how to, hosted fields, braintree js v3, ES2015, ES6, braintree-web, braintree-web/client, braintree-web/hosted-fields</h5></div><div class="article-body"><p>These days Braintree has excellent developer reference guides for their many SDKs, the ones I'm most familiar with being the Javascript/NodeJS ones. Which can be found here:</p><p><a href="https://developers.braintreepayments.com/start/overview">https://developers.braintreepayments.com/start/overview</a></p><p>Steal Braintree's beautiful visual representation  of how one should interact with their SDKs? Don't mind if I do.</p><img src="/public/braintree.png"><p>In my own words, the above represented steps:</p><p>1a. Create a function on you server for handling a request from your client for a Braintree Client Token</p><p>1b. Get a Client Token from Braintree on your server, using the server-side SDK</p><p>2a. Send the Client Token from your server to your client</p><p>2b. Initialize the client-side SDK using the Client Token, which creates a Hosted Fields</p><p>3a. The user then submits their payment information through the Braintree Hosted Fields to Braintree</p><p>3b. Braintree then returns a Payment Nonce to the client SDK, which represents the user's payment information</p><p>4. Send the Payment Nonce from your client to your server</p><p>5. Your server takes the Payment Nonce, and uses the server-side SDK to create a monetary transaction</p><p>Below is a basic implementation in Javascript ES6 (love me some arrow functions) of the above described  5 step process, utilizing the JS v3 SDK with the Hosted Fields, instead of the simpler Braintree Dropin.</p><p>While it is faster and as I said simpler to go with the Dropin, you have much higher degree of control of checkout behavior with Hosted Fields, and the UI.</p><p>So for my purposes I went with the Hosted Fields, even though in the end it results in a lot more work. Both the Hosted Fields and the Dropin utilize iframe/s, the only difference being that Hosted Fields puts the iframe in the specific input window elements specified, while the Drop in puts the entire payment form into an iframe.</p><h3>in terminal, in your code repo<div class="terminal-text"><div class="comment"># -1. before you can do anything with Braintree you need to install it's npm module <br></div>	npm install braintree <br> <br></div></h3><h3>server.js<div class="terminal-text"><div class="comment"># 0. before you can start using Braintree's SDK in your server code, you need to import and configure your Braintree environment <br></div>	import braintree from "braintree"; <br><let>gateway = braintree.connect({ <br></let><div class="tab">	environment: 'sandbox' || 'production', <br>
	merchantId: "useYourMerchantId", <br>
	publicKey: "useYourPublicKey", <br>
	privateKey: "useYourPrivateKey" <br></div>}); <br><br><div class="comment"># 1. create your own server-side function for handling the client-side request for a Client Token</div>app.get("/client_token", function (req, res) {<div class="tab"><div class="comment"># 1. request a Client Token from Braintree <br></div>	gateway.clientToken.generate({}, function (err, response) { <br><div class="tab"><div class="comment"># 2a. send the Client Token back down to your client <br></div>	res.send(response.clientToken); <br></div>}); <br></div>}); <br><br></div></h3><h3>client.js<div class="terminal-text"><div class="html">&lt;head&gt;</div><div class="tab"><div class="html">&lt;meta charset=&quot;utf-8&quot;&gt;</div></div><div class="html">&lt;/head&gt;</div><div class="html">&lt;body&gt;</div><div class="tab"><div class="html">&lt;label&gt;Credit Card Number&lt;/label&gt;</div><div class="html">&lt;div id=&quot;card-number&quot; /&gt;</div><br><div class="html">&lt;label&gt;CVV&lt;/label&gt;</div><div class="html">&lt;div id=&quot;cvv&quot; /&gt;</div><br><div class="html">&lt;label&gt;Expiration Date (MM/YYYY)&lt;/label&gt;</div><div class="html">&lt;div id=&quot;expiration-date&quot; /&gt;</div><br><div class="html">&lt;label&gt;Zipcode&lt;/label&gt;</div><div class="html">&lt;div id=&quot;postalCode&quot; /&gt;</div></div><div class="html">&lt;/body&gt;</div><div class="html">&lt;script&gt;</div><div class="tab"><div class="comment"># install Braintree client SDK and Hosted Fields <br></div><import>btClient from 'braintree-web/client'; <br></import><import>btHostedFields from 'braintree-web/hosted-fields'; <br><br></import><div class="comment"># 2b. initialize Braintree Hosted Fields, with Client Token<br></div>	btClient.create({ authorization: clientToken }, <br><div class="tab">	function(err, instance) { <br>
	btHostedFields.create({ <br><div class="tab">	client: instance, <br>
	styles: { <br><div class="tab">'input': { <br><div class="tab">'color': '#000', <br>
'font-size': '12pt' <br></div>}, <br>
'input.invalid': { 'color': 'tomato' }, <br>
'input.valid': { 'color': 'limegreen' } <br></div>},  <br>
	fields: {  <br><div class="tab"><number>{ selector: "#cc" },  <br></number><expirationdate>{ selector: "#exp-date" },  <br></expirationdate><cvv>{ selector: "#cvv" },  <br></cvv><postalcode>{ selector: "#postalCode" },  <br></postalcode></div>	}  <br></div>	}, (err, instance) => { <br><div class="comment"># 3a. Set-up listener on the Hosted Fields submit button, so that we can trigger the Hosted Fields consumption of the customer's payment information</div><div class="tab">document.querySelector( "#bt-submit").addEventListener('click',<div class="tab">(event) => { <br><div class="comment"># 3b. Braintree returns a Payment Nonce to the Hosted Fields, which represents the customer's supplied payment method information</div><div class="tab">hostedFieldsObj.instance.tokenize( <br><div class="comment"># 4. Send the Payment Nonce to our server <br></div><div class="comment">#		Another aspect that must be dealt with when utilizing the Hosted Fields, but not the Drop-in, is that we must handle the display of errors that Braintree sends our way when they failed to create a Payment Nonce from the information the customer submitted, these errors are stored in tokenizeErr</div>	(tokenizeErr, payload) => checkoutFunction(payload.nonce) ) <br></div>	}, false); <br></div></div>	}); <br></div>	}); <br></div><div class="html">&lt;/script&gt;</div></div></h3><h3>server.js (cont)<div class="terminal-text"><div class="comment"># 5. consume Payment Nonce in a transaction on your server-side <br></div>	app.post("/checkout", (req, res) => {  <br><div class="tab">	var nonceFromTheClient = req.body.payment_method_nonce; <br>
	gateway.transaction.sale({<div class="tab">	amount: "10.00", <br>
	paymentMethodNonce: nonceFromTheClient, <br><div class="comment"># for the execution of a transaction.sale() in Braintree Production environment the following line is necessary, but not in Braintree Sandbox environment</div>merchantAccountId: yourMerchantId, <br>
	options: { submitForSettlement: true } <br></div>	}, (err, result) => {} <br></div>	});</div></h3></div></div><div class="footer"><div class="intro-inner"><div class="center"><div class="social-icons"><a href="https://www.github.com/gato333"><div class="social-icon github"></div></a><a href="https://www.linkedin.com/in/gabrielavoll/"><div class="social-icon linkedin"></div></a></div></div><p class="center">Gabriela Voll Full-stack Web Developer<br/><a href="mailto:gvoll333@gmail.com">gvoll333@gmail.com</a></p></div></div></body></html>